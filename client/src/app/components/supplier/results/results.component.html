<div class="table-settings">
  <nb-select [(ngModel)]="view">
    <nb-option value="overview">Overview</nb-option>

    <nb-option-group title="Focus User">
      <nb-option *ngFor="let client of clients" [value]="client.email">{{
        client.firstName + " " + client.lastName
      }}</nb-option>
    </nb-option-group>
  </nb-select>
  <nb-toggle [(ngModel)]="tableSettings.minified">Minify Status</nb-toggle>
</div>
<div class="results-matrix" *ngIf="project && clients.length > 0">
  <div class="headings" id="table-headings">
    <span class="step-column"></span>
    <h6 class="client-column" *ngFor="let client of getClientsToShow()">
      {{ client.firstName + " " + client.lastName }}
    </h6>
  </div>

  <div
    class="suite"
    *ngFor="let suite of project.suites"
    (click)="collapse($event, suite)"
  >
    <div class="row">
      <p>
        <nb-icon
          [icon]="suite.collapsed ? 'arrow-right' : 'arrow-down'"
        ></nb-icon>
        <b>{{ suite.title }}</b>
      </p>
    </div>
    <span *ngIf="!suite.collapsed">
      <div
        class="case"
        *ngFor="let case of suite.cases"
        (click)="collapse($event, case)"
      >
        <span *ngIf="case.steps.length > 0">
          <div class="row">
            <p>
              <nb-icon
                [icon]="case.collapsed ? 'arrow-right' : 'arrow-down'"
              ></nb-icon
              ><b>{{ case.title }}</b>
            </p>
          </div>
          <span *ngIf="!case.collapsed">
            <div
              class="step row"
              *ngFor="let step of case.steps"
              (click)="collapse($event, {})"
            >
              <p class="step-column">{{ step.description }}</p>
              <div class="indicators">
                <span
                  class="notes"
                  *ngIf="
                    view !== 'overview' &&
                    getClientFeedbackNotesForStep({ email: view }, step)
                  "
                  ><nb-icon icon="message-square-outline"></nb-icon
                ></span>
              </div>
              <div
                *ngFor="let client of getClientsToShow()"
                class="client-column"
              >
                <app-step-status-chip
                  [minified]="tableSettings.minified"
                  [status]="getClientFeedbackStatusForStep(client, step)"
                ></app-step-status-chip>
              </div>
              <button
                class="details-button"
                nbButton
                ghost
                size="small"
                *ngIf="view !== 'overview'"
                (click)="openFeedbackModal({ email: view }, step)"
              >
                Details
              </button>
            </div>
          </span>
        </span>
      </div>
    </span>
  </div>
</div>

<div class="center" *ngIf="clients.length === 0">
  <h4>Add a client to this project to start seeing results!</h4>
</div>

<div class="center" *ngIf="!project">
  <h4>Error finding project details</h4>
</div>
